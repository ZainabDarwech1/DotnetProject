@model LebAssist.Presentation.ViewModels.Profile.EditProfileViewModel
@{
    ViewData["Title"] = "Edit Profile";
}

<div class="edit-profile-page">
    <!-- Header Section -->
    <div class="page-header">
        <div class="container">
            <!-- Breadcrumb -->
            <nav class="custom-breadcrumb" aria-label="breadcrumb">
                <ol class="breadcrumb-list">
                    <li class="breadcrumb-item">
                        <a href="@Url.Action("Index", "Home")">
                            <i class="bi bi-house-door"></i>
                            Home
                        </a>
                    </li>
                    <li class="breadcrumb-separator">
                        <i class="bi bi-chevron-right"></i>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="@Url.Action("Index", "Profile")">
                            <i class="bi bi-person-circle"></i>
                            My Profile
                        </a>
                    </li>
                    <li class="breadcrumb-separator">
                        <i class="bi bi-chevron-right"></i>
                    </li>
                    <li class="breadcrumb-item active">
                        Edit Profile
                    </li>
                </ol>
            </nav>

            <!-- Page Title -->
            <div class="page-title-section">
                <h1 class="page-title">
                    <i class="bi bi-pencil-square"></i>
                    Edit Profile
                </h1>
                <p class="page-subtitle">Update your personal information and settings</p>
            </div>
        </div>
    </div>

    <!-- Content Section -->
    <div class="container form-content">
        <div class="form-wrapper">
            <form asp-action="Edit" method="post" enctype="multipart/form-data" id="editProfileForm">
                <!-- Validation Summary -->
                <div asp-validation-summary="ModelOnly" class="custom-alert alert-danger"></div>

                <!-- Personal Information Card -->
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="card-icon">
                            <i class="bi bi-person-fill"></i>
                        </div>
                        <div class="card-title-section">
                            <h3 class="card-title">Personal Information</h3>
                            <p class="card-subtitle">Update your basic details</p>
                        </div>
                    </div>
                    <div class="form-card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label asp-for="FirstName" class="form-label">
                                    <i class="bi bi-person"></i>
                                    First Name
                                    <span class="required">*</span>
                                </label>
                                <input asp-for="FirstName" class="form-control" placeholder="Enter your first name" />
                                <span asp-validation-for="FirstName" class="validation-message"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="LastName" class="form-label">
                                    <i class="bi bi-person"></i>
                                    Last Name
                                    <span class="required">*</span>
                                </label>
                                <input asp-for="LastName" class="form-control" placeholder="Enter your last name" />
                                <span asp-validation-for="LastName" class="validation-message"></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label asp-for="PhoneNumber" class="form-label">
                                <i class="bi bi-telephone"></i>
                                Phone Number
                                <span class="required">*</span>
                            </label>
                            <input asp-for="PhoneNumber" class="form-control" placeholder="Enter your phone number" />
                            <span asp-validation-for="PhoneNumber" class="validation-message"></span>
                        </div>
                    </div>
                </div>

                <!-- Location Card -->
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="card-icon">
                            <i class="bi bi-geo-alt-fill"></i>
                        </div>
                        <div class="card-title-section">
                            <h3 class="card-title">Location</h3>
                            <p class="card-subtitle">Set your service location coordinates</p>
                        </div>
                    </div>
                    <div class="form-card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label asp-for="Latitude" class="form-label">
                                    <i class="bi bi-geo"></i>
                                    Latitude
                                    <span class="required">*</span>
                                </label>
                                <input asp-for="Latitude"
                                       class="form-control"
                                       type="number"
                                       step="0.000001"
                                       placeholder="e.g., 33.8938" />
                                <span asp-validation-for="Latitude" class="validation-message"></span>
                                <div class="form-hint">
                                    <i class="bi bi-info-circle"></i>
                                    <span>Range: -90 to 90</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label asp-for="Longitude" class="form-label">
                                    <i class="bi bi-geo"></i>
                                    Longitude
                                    <span class="required">*</span>
                                </label>
                                <input asp-for="Longitude"
                                       class="form-control"
                                       type="number"
                                       step="0.000001"
                                       placeholder="e.g., 35.5018" />
                                <span asp-validation-for="Longitude" class="validation-message"></span>
                                <div class="form-hint">
                                    <i class="bi bi-info-circle"></i>
                                    <span>Range: -180 to 180</span>
                                </div>
                            </div>
                        </div>

                        <div class="location-info">
                            <i class="bi bi-lightbulb"></i>
                            <span>Use precise coordinates to help clients find your services. You can get coordinates from Google Maps.</span>
                        </div>
                    </div>
                </div>

                @if (User.IsInRole("Provider"))
                {
                    <!-- Provider Information Card -->
                    <div class="form-card">
                        <div class="form-card-header">
                            <div class="card-icon">
                                <i class="bi bi-briefcase-fill"></i>
                            </div>
                            <div class="card-title-section">
                                <h3 class="card-title">Provider Information</h3>
                                <p class="card-subtitle">Tell clients about your expertise</p>
                            </div>
                        </div>
                        <div class="form-card-body">
                            <div class="form-group">
                                <label asp-for="YearsOfExperience" class="form-label">
                                    <i class="bi bi-award"></i>
                                    Years of Experience
                                </label>
                                <input asp-for="YearsOfExperience"
                                class="form-control"
                                type="number"
                                min="0"
                                placeholder="Enter your years of experience" />
                                <span asp-validation-for="YearsOfExperience" class="validation-message"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Bio" class="form-label">
                                    <i class="bi bi-file-text"></i>
                                    About Me / Bio
                                </label>
                                <textarea asp-for="Bio"
                                class="form-control bio-textarea"
                                rows="6"
                                placeholder="Tell clients about your background, expertise, and what makes you unique..."></textarea>
                                <span asp-validation-for="Bio" class="validation-message"></span>
                                <div class="char-counter">
                                    <i class="bi bi-chat-text"></i>
                                    <span id="bioCharCount">0</span> characters
                                </div>
                            </div>
                        </div>
                    </div>
                }

                <!-- Profile Photo Card -->
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="card-icon">
                            <i class="bi bi-camera-fill"></i>
                        </div>
                        <div class="card-title-section">
                            <h3 class="card-title">Profile Photo</h3>
                            <p class="card-subtitle">Upload a professional photo</p>
                        </div>
                    </div>
                    <div class="form-card-body">
                        <!-- Image Preview -->
                        <div class="image-preview-container" id="imagePreviewContainer" style="display: none;">
                            <img id="imagePreview" src="" alt="Preview" class="image-preview">
                            <button type="button" class="btn-remove-preview" onclick="removePreview()">
                                <i class="bi bi-x-circle"></i>
                            </button>
                        </div>

                        <div class="form-group">
                            <label asp-for="ProfilePhoto" class="form-label">
                                <i class="bi bi-image"></i>
                                Choose Photo
                            </label>
                            <div class="file-input-wrapper">
                                <input asp-for="ProfilePhoto"
                                       class="file-input"
                                       type="file"
                                       accept="image/jpeg,image/jpg,image/png,image/webp"
                                       id="ProfilePhoto"
                                       onchange="previewImage(this)" />
                                <label for="ProfilePhoto" class="file-input-label">
                                    <i class="bi bi-cloud-upload"></i>
                                    <span class="file-text">Choose a photo or drag it here</span>
                                    <span class="file-hint">JPG, PNG, WEBP • Max 5MB</span>
                                </label>
                            </div>
                            <span asp-validation-for="ProfilePhoto" class="validation-message"></span>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-submit">
                        <i class="bi bi-check-circle"></i>
                        Save Changes
                    </button>
                    <a href="@Url.Action("Index", "Profile")" class="btn btn-cancel">
                        <i class="bi bi-x-circle"></i>
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/editProfile.css" />
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Image preview
            window.previewImage = function(input) {
                const file = input.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('imagePreview').src = e.target.result;
                        document.getElementById('imagePreviewContainer').style.display = 'block';
                        document.querySelector('.file-input-label').style.display = 'none';
                    };
                    reader.readAsDataURL(file);
                }
            };

            window.removePreview = function() {
                document.getElementById('ProfilePhoto').value = '';
                document.getElementById('imagePreviewContainer').style.display = 'none';
                document.querySelector('.file-input-label').style.display = 'flex';
            };

            // Bio character counter
            const bioTextarea = document.getElementById('Bio');
            const bioCharCount = document.getElementById('bioCharCount');

            if (bioTextarea && bioCharCount) {
                // Update count on page load
                bioCharCount.textContent = bioTextarea.value.length;

                bioTextarea.addEventListener('input', function() {
                    bioCharCount.textContent = this.value.length;
                });
            }

            // Form animation on load
            const formCards = document.querySelectorAll('.form-card');
            formCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 150);
            });

            // Form submission
            const form = document.getElementById('editProfileForm');
            form.addEventListener('submit', function() {
                const submitBtn = form.querySelector('.btn-submit');
                submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Saving Changes...';
                submitBtn.disabled = true;
            });
        });
    </script>
}
