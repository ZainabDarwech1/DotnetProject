@model LebAssist.Presentation.ViewModels.Review.MyReviewsViewModel
@{
    ViewData["Title"] = "My Reviews";
}

<div class="reviews-page">
    <!-- Header Section -->
    <div class="page-header">
        <div class="container">
            <!-- Breadcrumb -->
            <nav class="custom-breadcrumb" aria-label="breadcrumb">
                <ol class="breadcrumb-list">
                    <li class="breadcrumb-item">
                        <a href="@Url.Action("Index", "Home")">
                            <i class="bi bi-house-door"></i>
                            Home
                        </a>
                    </li>
                    <li class="breadcrumb-separator">
                        <i class="bi bi-chevron-right"></i>
                    </li>
                    <li class="breadcrumb-item active">
                        My Reviews
                    </li>
                </ol>
            </nav>

            <!-- Page Title -->
            <div class="page-title-section">
                <h1 class="page-title">
                    <i class="bi bi-star-fill"></i>
                    My Reviews
                </h1>
                <p class="page-subtitle">Manage and track all your service reviews</p>
            </div>

            <!-- Stats Badge -->
            @if (Model.TotalReviews > 0)
            {
                <div class="stats-badge">
                    <div class="stat-item">
                        <i class="bi bi-chat-square-text"></i>
                        <span class="stat-value">@Model.TotalReviews</span>
                        <span class="stat-label">@(Model.TotalReviews == 1 ? "Review" : "Reviews")</span>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Reviews Content Section -->
    <div class="container reviews-content">
        @if (!Model.Reviews.Any())
        {
            <!-- Empty State -->
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="bi bi-chat-square-text"></i>
                </div>
                <h3 class="empty-title">No Reviews Yet</h3>
                <p class="empty-description">You haven't written any reviews yet. Complete a booking to leave a review!</p>
                <a asp-controller="Booking" asp-action="MyBookings" class="btn btn-primary">
                    <i class="bi bi-calendar-check"></i>
                    View My Bookings
                </a>
            </div>
        }
        else
        {
            <!-- Reviews Grid -->
            <div class="reviews-grid">
                @foreach (var review in Model.Reviews)
                {
                    <div class="review-card">
                        <!-- Review Header -->
                        <div class="review-header">
                            <div class="review-info">
                                <div class="provider-section">
                                    <h3 class="provider-name">
                                        <i class="bi bi-person-badge"></i>
                                        @review.ProviderName
                                    </h3>
                                    <div class="badges">
                                        @if (!review.IsVisible)
                                        {
                                            <span class="badge badge-hidden">
                                                <i class="bi bi-eye-slash"></i>
                                                Hidden
                                            </span>
                                        }
                                        @if (review.IsAnonymous)
                                        {
                                            <span class="badge badge-anonymous">
                                                <i class="bi bi-incognito"></i>
                                                Anonymous
                                            </span>
                                        }
                                    </div>
                                </div>

                                <div class="service-info">
                                    <span class="service-name">
                                        <i class="bi bi-tools"></i>
                                        @review.ServiceName
                                    </span>
                                    <span class="review-date">
                                        <i class="bi bi-calendar"></i>
                                        @review.ReviewDate.ToString("MMM dd, yyyy")
                                    </span>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="review-actions">
                                @if (review.CanEdit)
                                {
                                    <a asp-action="Edit" asp-route-id="@review.ReviewId"
                                       class="btn btn-edit"
                                       title="Edit Review">
                                        <i class="bi bi-pencil"></i>
                                        Edit
                                    </a>
                                }
                                <form asp-action="Delete" asp-route-id="@review.ReviewId" method="post"
                                      onsubmit="return confirm('Are you sure you want to delete this review? This action cannot be undone.');"
                                      class="delete-form">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-delete" title="Delete Review">
                                        <i class="bi bi-trash"></i>
                                        Delete
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- Star Rating -->
                        <div class="rating-section">
                            <div class="stars">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= review.Rating)
                                    {
                                        <i class="bi bi-star-fill star-filled"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-star star-empty"></i>
                                    }
                                }
                            </div>
                            <span class="rating-value">@review.Rating/5</span>
                        </div>

                        <!-- Review Comment -->
                        <div class="review-comment">
                            @if (!string.IsNullOrEmpty(review.Comment))
                            {
                                <p class="comment-text">@review.Comment</p>
                            }
                            else
                            {
                                <p class="comment-empty">
                                    <i class="bi bi-chat-right-dots"></i>
                                    No written comment
                                </p>
                            }
                        </div>

                        <!-- Review Footer -->
                        @if (review.CanEdit)
                        {
                            <div class="review-footer">
                                <div class="edit-notice">
                                    <i class="bi bi-clock-history"></i>
                                    <span>You can edit this review until @review.ReviewDate.AddDays(7).ToString("MMM dd, yyyy")</span>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        }
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/myReviews.css" />
}

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add animation on scroll
            const reviewCards = document.querySelectorAll('.review-card');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry, index) => {
                    if (entry.isIntersecting) {
                        setTimeout(() => {
                            entry.target.style.opacity = '1';
                            entry.target.style.transform = 'translateY(0)';
                        }, index * 100);
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            reviewCards.forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                observer.observe(card);
            });

            // Confirm delete with better UX
            const deleteForms = document.querySelectorAll('.delete-form');
            deleteForms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    const button = this.querySelector('.btn-delete');
                    button.innerHTML = '<i class="bi bi-hourglass-split"></i> Deleting...';
                    button.disabled = true;
                });
            });
        });
    </script>
}
