@model LebAssist.Presentation.ViewModels.Provider.ProviderApplicationViewModel
@{
    ViewData["Title"] = "Become a Provider";
}

<div class="provider-application-page">
    <!-- Header Section -->
    <div class="page-header">
        <div class="container">
            <!-- Breadcrumb -->
            <nav class="custom-breadcrumb" aria-label="breadcrumb">
                <ol class="breadcrumb-list">
                    <li class="breadcrumb-item">
                        <a href="@Url.Action("Index", "Home")">
                            <i class="bi bi-house-door"></i>
                            Home
                        </a>
                    </li>
                    <li class="breadcrumb-separator">
                        <i class="bi bi-chevron-right"></i>
                    </li>
                    <li class="breadcrumb-item active">
                        Become a Provider
                    </li>
                </ol>
            </nav>

            <!-- Page Title -->
            <div class="page-title-section">
                <h1 class="page-title">
                    <i class="bi bi-person-badge"></i>
                    Become a Provider
                </h1>
                <p class="page-subtitle">Join our network and start earning today</p>
            </div>
        </div>
    </div>

    <!-- Content Section -->
    <div class="container form-content">
        <div class="form-wrapper">
            <form asp-action="Apply" method="post" enctype="multipart/form-data" id="providerApplicationForm">
                <!-- Validation Summary -->
                <div asp-validation-summary="ModelOnly" class="custom-alert alert-danger"></div>

                <!-- Personal Information Card -->
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="card-icon">
                            <i class="bi bi-person-fill"></i>
                        </div>
                        <div class="card-title-section">
                            <h3 class="card-title">Your Information</h3>
                            <p class="card-subtitle">Your current account details</p>
                        </div>
                    </div>
                    <div class="form-card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-person"></i>
                                    Full Name
                                </label>
                                <div class="readonly-field">
                                    <i class="bi bi-lock-fill"></i>
                                    <span>@Model.FirstName @Model.LastName</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-telephone"></i>
                                    Phone Number
                                </label>
                                <div class="readonly-field">
                                    <i class="bi bi-lock-fill"></i>
                                    <span>@Model.PhoneNumber</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Photo Card -->
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="card-icon">
                            <i class="bi bi-camera-fill"></i>
                        </div>
                        <div class="card-title-section">
                            <h3 class="card-title">Profile Photo</h3>
                            <p class="card-subtitle">Upload a professional photo (optional but recommended)</p>
                        </div>
                    </div>
                    <div class="form-card-body">
                        <!-- Image Preview -->
                        <div id="profilePhotoPreview" class="image-preview-container" style="display: none;">
                            <img id="profilePhotoImg" src="" alt="Preview" class="image-preview">
                            <button type="button" class="btn-remove-preview" onclick="removeProfilePhoto()">
                                <i class="bi bi-x-circle"></i>
                            </button>
                        </div>

                        <div class="form-group">
                            <div class="file-upload-wrapper">
                                <input type="file"
                                       name="ProfilePhoto"
                                       accept="image/jpeg,image/png,image/webp"
                                       class="file-input"
                                       id="profilePhotoInput"
                                       onchange="previewProfilePhoto(this)" />
                                <label for="profilePhotoInput" class="file-upload-label">
                                    <i class="bi bi-cloud-upload"></i>
                                    <span class="file-text">Choose a photo or drag it here</span>
                                    <span class="file-hint">JPG, PNG, WEBP • Max 5MB</span>
                                </label>
                            </div>
                            <span asp-validation-for="ProfilePhoto" class="validation-message"></span>
                        </div>
                    </div>
                </div>

                <!-- About You Card -->
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="card-icon">
                            <i class="bi bi-file-text-fill"></i>
                        </div>
                        <div class="card-title-section">
                            <h3 class="card-title">About You</h3>
                            <p class="card-subtitle">Tell us about your experience and expertise</p>
                        </div>
                    </div>
                    <div class="form-card-body">
                        <div class="form-group">
                            <label asp-for="Bio" class="form-label">
                                <i class="bi bi-chat-text"></i>
                                <span>Your Bio</span>
                                <span class="required">*</span>
                            </label>
                            <textarea asp-for="Bio"
                                      class="form-control bio-textarea"
                                      rows="6"
                                      placeholder="Describe your experience, skills, and why clients should choose you..."
                                      id="bioInput"></textarea>
                            <span asp-validation-for="Bio" class="validation-message"></span>
                            <div class="char-counter">
                                <i class="bi bi-chat-text"></i>
                                <span id="bioCharCount">0</span>/500 characters (min 50)
                            </div>
                        </div>

                        <div class="form-group">
                            <label asp-for="YearsOfExperience" class="form-label">
                                <i class="bi bi-award"></i>
                                <span>Years of Experience</span>
                                <span class="required">*</span>
                            </label>
                            <input asp-for="YearsOfExperience"
                                   type="number"
                                   class="form-control experience-input"
                                   min="0"
                                   max="50"
                                   placeholder="Enter years of experience" />
                            <span asp-validation-for="YearsOfExperience" class="validation-message"></span>
                        </div>
                    </div>
                </div>

                <!-- Services Selection Card -->
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="card-icon">
                            <i class="bi bi-tools"></i>
                        </div>
                        <div class="card-title-section">
                            <h3 class="card-title">Services You Offer</h3>
                            <p class="card-subtitle">Select at least one service you can provide</p>
                        </div>
                    </div>
                    <div class="form-card-body">
                        <div class="services-info">
                            <i class="bi bi-info-circle"></i>
                            <span>Choose the services you're qualified to provide. You can update these later.</span>
                        </div>

                        @foreach (var category in Model.ServiceCategories)
                        {
                            <div class="service-category">
                                <h4 class="category-title">
                                    <i class="bi bi-bookmark-fill"></i>
                                    @category.CategoryName
                                </h4>
                                <div class="services-grid">
                                    @foreach (var service in category.Services)
                                    {
                                        <div class="service-checkbox-wrapper">
                                            <input class="checkbox-input service-checkbox"
                                                   type="checkbox"
                                                   name="SelectedServiceIds"
                                                   value="@service.ServiceId"
                                                   id="service-@service.ServiceId"
                                                   data-service-name="@service.ServiceName"
                                                   @(Model.SelectedServiceIds.Contains(service.ServiceId) ? "checked" : "")>
                                            <label for="service-@service.ServiceId" class="service-checkbox-label">
                                                <span class="checkbox-box">
                                                    <i class="bi bi-check"></i>
                                                </span>
                                                <span class="service-name">@service.ServiceName</span>
                                            </label>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <!-- Working Hours Card (Dynamic) -->
                <div class="form-card" id="workingHoursSection" style="display: none;">
                    <div class="form-card-header">
                        <div class="card-icon">
                            <i class="bi bi-clock-history"></i>
                        </div>
                        <div class="card-title-section">
                            <h3 class="card-title">Working Hours</h3>
                            <p class="card-subtitle">Set your availability for each selected service</p>
                        </div>
                    </div>
                    <div class="form-card-body">
                        <div id="workingHoursContainer">
                            <!-- Dynamic content added by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Portfolio Photos Card -->
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="card-icon">
                            <i class="bi bi-images"></i>
                        </div>
                        <div class="card-title-section">
                            <h3 class="card-title">Portfolio Photos</h3>
                            <p class="card-subtitle">Showcase your work (optional but recommended)</p>
                        </div>
                    </div>
                    <div class="form-card-body">
                        <div class="form-group">
                            <div class="file-upload-wrapper">
                                <input type="file"
                                       name="PortfolioPhotos"
                                       accept="image/jpeg,image/png,image/webp"
                                       multiple
                                       class="file-input"
                                       id="portfolioPhotosInput"
                                       onchange="previewPortfolioPhotos(this)" />
                                <label for="portfolioPhotosInput" class="file-upload-label">
                                    <i class="bi bi-cloud-upload"></i>
                                    <span class="file-text">Choose photos or drag them here</span>
                                    <span class="file-hint">Up to 5 photos • JPG, PNG, WEBP • Max 5MB each</span>
                                </label>
                            </div>
                            <span asp-validation-for="PortfolioPhotos" class="validation-message"></span>
                        </div>

                        <div id="portfolioPreviewContainer" class="portfolio-preview-grid"></div>
                    </div>
                </div>

                <!-- Terms Agreement -->
                <div class="form-card terms-card">
                    <div class="form-card-body">
                        <div class="custom-checkbox">
                            <input class="checkbox-input"
                                   type="checkbox"
                                   id="agreeTerms"
                                   required>
                            <label for="agreeTerms" class="checkbox-label">
                                <span class="checkbox-box">
                                    <input type="checkbox"/>
                                </span>
                                <span class="checkbox-text">
                                    I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal" class="terms-link">Terms of Service</a> for providers
                                </span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-submit">
                        <i class="bi bi-send"></i>
                        Submit Application
                    </button>
                    <a asp-controller="Home" asp-action="Index" class="btn btn-cancel">
                        <i class="bi bi-x-circle"></i>
                        Cancel
                    </a>
                </div>
            </form>

            <!-- What Happens Next Card -->
            <div class="info-card-large">
                <div class="info-card-header">
                    <i class="bi bi-info-circle"></i>
                    <h3>What Happens Next?</h3>
                </div>
                <div class="info-card-content">
                    <ol class="steps-list">
                        <li>
                            <div class="step-icon">
                                <i class="bi bi-search"></i>
                            </div>
                            <div class="step-content">
                                <strong>Application Review</strong>
                                <p>Your application will be reviewed by our team</p>
                            </div>
                        </li>
                        <li>
                            <div class="step-icon">
                                <i class="bi bi-bell"></i>
                            </div>
                            <div class="step-content">
                                <strong>Notification</strong>
                                <p>You'll receive a notification once approved (usually within 24-48 hours)</p>
                            </div>
                        </li>
                        <li>
                            <div class="step-icon">
                                <i class="bi bi-check-circle"></i>
                            </div>
                            <div class="step-content">
                                <strong>Start Earning</strong>
                                <p>After approval, you can start accepting bookings and emergency requests</p>
                            </div>
                        </li>
                        <li>
                            <div class="step-icon">
                                <i class="bi bi-gear"></i>
                            </div>
                            <div class="step-content">
                                <strong>Manage Your Profile</strong>
                                <p>Update your services, working hours, and pricing anytime</p>
                            </div>
                        </li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Terms Modal -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-file-text"></i>
                    Provider Terms of Service
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p><strong>By becoming a provider on LebAssist, you agree to:</strong></p>
                <ul class="terms-list">
                    <li>Provide accurate information about your skills and experience</li>
                    <li>Respond to booking requests in a timely manner</li>
                    <li>Deliver quality service to all clients</li>
                    <li>Maintain professional conduct at all times</li>
                    <li>Keep your availability status updated</li>
                    <li>Not share customer information with third parties</li>
                    <li>Report any issues or disputes within 48 hours</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                    <i class="bi bi-check"></i>
                    I Understand
                </button>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/providerApply.css" />
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

        // Bio character counter
        const bioInput = document.getElementById('bioInput');
        const bioCharCount = document.getElementById('bioCharCount');

        if (bioInput && bioCharCount) {
            bioCharCount.textContent = bioInput.value.length;
            bioInput.addEventListener('input', function() {
                bioCharCount.textContent = this.value.length;
            });
        }

        // Profile photo preview
        function previewProfilePhoto(input) {
            const preview = document.getElementById('profilePhotoPreview');
            const img = document.getElementById('profilePhotoImg');
            const label = document.querySelector('label[for="profilePhotoInput"]');

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    img.src = e.target.result;
                    preview.style.display = 'block';
                    label.style.display = 'none';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function removeProfilePhoto() {
            document.getElementById('profilePhotoInput').value = '';
            document.getElementById('profilePhotoPreview').style.display = 'none';
            document.querySelector('label[for="profilePhotoInput"]').style.display = 'flex';
        }

        // Portfolio photos preview
        function previewPortfolioPhotos(input) {
            const container = document.getElementById('portfolioPreviewContainer');
            container.innerHTML = '';

            if (input.files.length > 5) {
                alert('You can upload a maximum of 5 photos.');
                input.value = '';
                return;
            }

            Array.from(input.files).forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoDiv = document.createElement('div');
                    photoDiv.className = 'portfolio-preview-item';
                    photoDiv.innerHTML = `
                        <img src="${e.target.result}" alt="Portfolio ${index + 1}">
                        <span class="photo-number">#${index + 1}</span>
                    `;
                    container.appendChild(photoDiv);
                };
                reader.readAsDataURL(file);
            });
        }

        // Handle service checkbox changes
        document.querySelectorAll('.service-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', updateWorkingHours);
        });

        // Update working hours section
        function updateWorkingHours() {
            const selectedServices = Array.from(document.querySelectorAll('.service-checkbox:checked'))
                .map(cb => ({
                    serviceId: cb.value,
                    serviceName: cb.dataset.serviceName
                }));

            const container = document.getElementById('workingHoursContainer');
            const section = document.getElementById('workingHoursSection');

            if (selectedServices.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            container.innerHTML = '';

            selectedServices.forEach(service => {
                const serviceHtml = `
                    <div class="working-hours-service">
                        <h4 class="service-hours-title">
                            <i class="bi bi-clock"></i>
                            ${service.serviceName}
                        </h4>
                        <div class="hours-table-wrapper">
                            <table class="hours-table">
                                <thead>
                                    <tr>
                                        <th>Day</th>
                                        <th>Available</th>
                                        <th>Start Time</th>
                                        <th>End Time</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${days.map((day, index) => `
                                        <tr class="hours-row">
                                            <td class="day-name">${day}</td>
                                            <td class="checkbox-cell">
                                                <label class="custom-checkbox-small">
                                                    <input type="checkbox"
                                                           class="checkbox-input day-checkbox"
                                                           name="isDay_${service.serviceId}_${index}"
                                                           data-service-id="${service.serviceId}"
                                                           data-day="${index}"
                                                           value="on">
                                                    <span class="checkbox-box-small">
                                                        <i class="bi bi-check"></i>
                                                    </span>
                                                </label>
                                            </td>
                                            <td class="time-cell">
                                                <input type="time"
                                                       class="time-input"
                                                       name="startTime_${service.serviceId}_${index}"
                                                       value="09:00"
                                                       data-service-id="${service.serviceId}"
                                                       data-day="${index}"
                                                       disabled>
                                            </td>
                                            <td class="time-cell">
                                                <input type="time"
                                                       class="time-input"
                                                       name="endTime_${service.serviceId}_${index}"
                                                       value="17:00"
                                                       data-service-id="${service.serviceId}"
                                                       data-day="${index}"
                                                       disabled>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', serviceHtml);
            });

            // Enable/disable time inputs
            document.querySelectorAll('.day-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const serviceId = this.dataset.serviceId;
                    const day = this.dataset.day;
                    const row = this.closest('.hours-row');
                    const startInput = row.querySelector(`input[name="startTime_${serviceId}_${day}"]`);
                    const endInput = row.querySelector(`input[name="endTime_${serviceId}_${day}"]`);

                    startInput.disabled = !this.checked;
                    endInput.disabled = !this.checked;

                    if (this.checked) {
                        row.classList.add('active');
                    } else {
                        row.classList.remove('active');
                    }
                });
            });
        }

        // Animate cards on load
        document.addEventListener('DOMContentLoaded', function() {
            const formCards = document.querySelectorAll('.form-card, .info-card-large');
            formCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
}
