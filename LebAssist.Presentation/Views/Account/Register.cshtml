@using Microsoft.Extensions.Options
@using LebAssist.Application.Common
@inject IOptions<GoogleMapsSettings> GoogleMapsSettings
@model LebAssist.Presentation.ViewModels.Account.RegisterViewModel
@{
    ViewData["Title"] = "Register";
    var apiKey = GoogleMapsSettings.Value.ApiKey;
}

<div class="auth-page">
    <!-- Header Section -->
    <div class="auth-header">
        <div class="container">
            <div class="auth-hero">
                <div class="hero-icon">
                    <i class="bi bi-person-plus"></i>
                </div>
                <h1 class="hero-title">Join LebAssist</h1>
                <p class="hero-subtitle">Create your account and get started</p>
            </div>
        </div>
    </div>

    <!-- Register Form Section -->
    <div class="container auth-content">
        <div class="auth-wrapper register-wrapper">
            <div class="auth-card">
                <div class="card-header">
                    <h2>Create Account</h2>
                    <p>Fill in your details to register</p>
                </div>

                <div class="card-body">
                    <form asp-action="Register" method="post" enctype="multipart/form-data" class="auth-form">
                        <div asp-validation-summary="ModelOnly" class="validation-alert"></div>

                        <!-- Name Fields -->
                        <div class="form-row">
                            <div class="form-group">
                                <label asp-for="FirstName" class="form-label">
                                    <i class="bi bi-person"></i>
                                    <span>First Name</span>
                                </label>
                                <input asp-for="FirstName"
                                       class="form-control"
                                       placeholder="Enter your first name" />
                                <span asp-validation-for="FirstName" class="validation-message"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="LastName" class="form-label">
                                    <i class="bi bi-person"></i>
                                    <span>Last Name</span>
                                </label>
                                <input asp-for="LastName"
                                       class="form-control"
                                       placeholder="Enter your last name" />
                                <span asp-validation-for="LastName" class="validation-message"></span>
                            </div>
                        </div>

                        <!-- Email Field -->
                        <div class="form-group">
                            <label asp-for="Email" class="form-label">
                                <i class="bi bi-envelope"></i>
                                <span>Email Address</span>
                            </label>
                            <input asp-for="Email"
                                   class="form-control"
                                   placeholder="Enter your email" />
                            <span asp-validation-for="Email" class="validation-message"></span>
                        </div>

                        <!-- Phone Number Field -->
                        <div class="form-group">
                            <label asp-for="PhoneNumber" class="form-label">
                                <i class="bi bi-telephone"></i>
                                <span>Phone Number</span>
                            </label>
                            <input asp-for="PhoneNumber"
                                   class="form-control"
                                   placeholder="Enter your phone number" />
                            <span asp-validation-for="PhoneNumber" class="validation-message"></span>
                        </div>

                        <!-- Password Fields -->
                        <div class="form-row">
                            <div class="form-group">
                                <label asp-for="Password" class="form-label">
                                    <i class="bi bi-lock"></i>
                                    <span>Password</span>
                                </label>
                                <div class="password-wrapper">
                                    <input asp-for="Password"
                                           class="form-control"
                                           type="password"
                                           id="passwordInput"
                                           placeholder="Create a password" />
                                    <button type="button" class="password-toggle" onclick="togglePassword()">
                                        <i class="bi bi-eye" id="toggleIcon"></i>
                                    </button>
                                </div>
                                <span asp-validation-for="Password" class="validation-message"></span>
                                <small class="form-hint">Min 8 chars, uppercase, lowercase, digit, special char</small>
                            </div>

                            <div class="form-group">
                                <label asp-for="ConfirmPassword" class="form-label">
                                    <i class="bi bi-lock-fill"></i>
                                    <span>Confirm Password</span>
                                </label>
                                <div class="password-wrapper">
                                    <input asp-for="ConfirmPassword"
                                           class="form-control"
                                           type="password"
                                           id="confirmPasswordInput"
                                           placeholder="Confirm your password" />
                                    <button type="button" class="password-toggle" onclick="toggleConfirmPassword()">
                                        <i class="bi bi-eye" id="toggleConfirmIcon"></i>
                                    </button>
                                </div>
                                <span asp-validation-for="ConfirmPassword" class="validation-message"></span>
                            </div>
                        </div>

                        <!-- Location Selection -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="bi bi-geo-alt"></i>
                                <span>Your Location</span>
                            </label>
                            <p class="location-hint">
                                <i class="bi bi-info-circle"></i>
                                Click on the map to set your location
                            </p>

                            <!-- Hidden fields -->
                            <input type="hidden" asp-for="Latitude" id="Latitude" />
                            <input type="hidden" asp-for="Longitude" id="Longitude" />

                            <!-- Map -->
                            <div class="map-container">
                                <div id="map" class="location-map"></div>
                            </div>

                            <!-- Display coordinates -->
                            <div class="coordinates-display">
                                <span class="coord-badge">
                                    <i class="bi bi-geo"></i>
                                    Lat: <span id="latText">Not set</span>
                                </span>
                                <span class="coord-badge">
                                    <i class="bi bi-geo"></i>
                                    Lng: <span id="lngText">Not set</span>
                                </span>
                            </div>

                            <span asp-validation-for="Latitude" class="validation-message"></span>
                        </div>

                        <!-- Profile Photo -->
                        <div class="form-group">
                            <label asp-for="ProfilePhoto" class="form-label">
                                <i class="bi bi-camera"></i>
                                <span>Profile Photo (Optional)</span>
                            </label>
                            <div class="file-upload-wrapper">
                                <input asp-for="ProfilePhoto"
                                       class="file-input"
                                       type="file"
                                       accept="image/*"
                                       id="profilePhotoInput"
                                       onchange="previewImage(this)" />
                                <label for="profilePhotoInput" class="file-upload-label">
                                    <i class="bi bi-cloud-upload"></i>
                                    <span id="fileName">Choose a photo</span>
                                </label>
                            </div>
                            <div id="imagePreview" class="image-preview" style="display: none;">
                                <img id="previewImg" src="" alt="Preview" />
                            </div>
                            <span asp-validation-for="ProfilePhoto" class="validation-message"></span>
                        </div>

                        <!-- Terms & Conditions -->
                        <div class="form-group">
                            <div class="custom-checkbox">
                                <input asp-for="AcceptTerms"
                                       class="checkbox-input"
                                       type="checkbox"
                                       id="termsCheck" />
                                <label for="termsCheck" class="checkbox-label">
                                    <span class="checkbox-box">
                                        <i class="bi bi-check"></i>
                                    </span>
                                    <span class="checkbox-text">
                                        I accept the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal" class="terms-link">terms and conditions</a>
                                    </span>
                                </label>
                            </div>
                            <span asp-validation-for="AcceptTerms" class="validation-message"></span>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-person-plus"></i>
                            <span>Create Account</span>
                        </button>

                        <!-- Divider -->
                        <div class="divider">
                            <span>or</span>
                        </div>

                        <!-- Login Link -->
                        <div class="register-section">
                            <p>Already have an account?</p>
                            <a asp-action="Login" class="btn btn-outline">
                                <i class="bi bi-box-arrow-in-right"></i>
                                <span>Sign In</span>
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Info Cards -->
            <div class="info-cards">
                <div class="info-card">
                    <i class="bi bi-shield-check"></i>
                    <h4>Free to Join</h4>
                    <p>Create your account at no cost</p>
                </div>
                <div class="info-card">
                    <i class="bi bi-lightning"></i>
                    <h4>Quick Setup</h4>
                    <p>Get started in just a few minutes</p>
                </div>
                <div class="info-card">
                    <i class="bi bi-patch-check"></i>
                    <h4>Verified Services</h4>
                    <p>Access trusted service providers</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Terms Modal -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-file-text"></i>
                    Terms and Conditions
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>1. Acceptance of Terms</h6>
                <p>By using LebAssist, you agree to these terms and conditions...</p>

                <h6>2. User Responsibilities</h6>
                <p>You are responsible for maintaining the confidentiality of your account...</p>

                <h6>3. Service Usage</h6>
                <p>LebAssist provides a platform to connect service providers with clients...</p>

                <h6>4. Privacy Policy</h6>
                <p>We respect your privacy and protect your personal information...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/auth.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/register.css" asp-append-version="true" />
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        var map;
        var marker;

        function initMap() {
            var defaultCenter = { lat: 33.8938, lng: 35.5018 };

            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 12,
                center: defaultCenter,
                styles: [
                    {
                        featureType: "poi",
                        elementType: "labels",
                        stylers: [{ visibility: "off" }]
                    }
                ]
            });

            map.addListener("click", function(e) {
                var lat = e.latLng.lat();
                var lng = e.latLng.lng();

                if (!marker) {
                    marker = new google.maps.Marker({
                        position: { lat: lat, lng: lng },
                        map: map,
                        animation: google.maps.Animation.DROP
                    });
                } else {
                    marker.setPosition({ lat: lat, lng: lng });
                }

                document.getElementById("Latitude").value = lat;
                document.getElementById("Longitude").value = lng;
                document.getElementById("latText").innerText = lat.toFixed(6);
                document.getElementById("lngText").innerText = lng.toFixed(6);
            });
        }

        function togglePassword() {
            const passwordInput = document.getElementById('passwordInput');
            const toggleIcon = document.getElementById('toggleIcon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('bi-eye');
                toggleIcon.classList.add('bi-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('bi-eye-slash');
                toggleIcon.classList.add('bi-eye');
            }
        }

        function toggleConfirmPassword() {
            const passwordInput = document.getElementById('confirmPasswordInput');
            const toggleIcon = document.getElementById('toggleConfirmIcon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('bi-eye');
                toggleIcon.classList.add('bi-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('bi-eye-slash');
                toggleIcon.classList.add('bi-eye');
            }
        }

        function previewImage(input) {
            const fileName = document.getElementById('fileName');
            const imagePreview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');

            if (input.files && input.files[0]) {
                fileName.textContent = input.files[0].name;

                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    imagePreview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=@apiKey&callback=initMap"></script>
}
